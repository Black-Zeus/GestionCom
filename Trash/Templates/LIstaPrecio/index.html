<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Listas de Precios</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="extra.css" />
</head>

<body>
    <!-- Contenedor de Toasts -->
    <div id="toast-container" class="toast-container"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üí∞ Sistema de Listas de Precios</h1>
            <div class="user-info">
                <strong>Usuario:</strong> <span id="user-name">Cargando...</span><br />
                <strong>Rol:</strong> <span id="user-role">Cargando...</span><br />
                <strong>Fecha:</strong> <span id="current-date"></span>
            </div>
        </div>

        <!-- Navegaci√≥n Principal por Pesta√±as -->
        <div class="main-tabs">
            <button class="tab-button active" onclick="showTab('lists')">
                <span class="tab-icon">üìã</span>
                <span>Listas de Precios</span>
                <span class="tab-badge" id="lists-badge">6</span>
            </button>
            <button class="tab-button" onclick="showTab('products')">
                <span class="tab-icon">üè∑Ô∏è</span>
                <span>Productos y Precios</span>
                <span class="tab-badge" id="products-badge">12</span>
            </button>
            <button class="tab-button" onclick="showTab('comparison')">
                <span class="tab-icon">üìä</span>
                <span>Comparador</span>
            </button>
            <button class="tab-button" onclick="showTab('reports')">
                <span class="tab-icon">üìà</span>
                <span>Reportes</span>
            </button>
        </div>

        <!-- Contenido de Pesta√±as -->
        <div class="tab-content">
            
            <!-- ============================================== -->
            <!-- PESTA√ëA: LISTAS DE PRECIOS -->
            <!-- ============================================== -->
            <div id="lists-tab" class="tab-panel active">
                <!-- Header de la secci√≥n -->
                <div class="price-lists-header">
                    <h2>
                        üìã Gesti√≥n de Listas de Precios
                    </h2>
                    <div class="header-actions">
                        <button class="btn btn-success" onclick="createPriceList()">
                            ‚ûï Nueva Lista
                        </button>
                        <button class="btn btn-info" onclick="exportPrices()">
                            üì§ Exportar
                        </button>
                        <button class="btn btn-secondary" onclick="importPrices()">
                            üì• Importar
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="price-lists-filters">
                    <h4>üîç Filtros</h4>
                    <div class="filters-grid">
                        <div class="form-group">
                            <label for="search-lists">Buscar lista</label>
                            <input type="text" id="search-lists" class="form-control" 
                                   placeholder="Buscar por nombre o c√≥digo..." autocomplete="off" />
                        </div>
                        <div class="form-group">
                            <label for="group-filter">Grupo</label>
                            <select id="group-filter" class="form-control">
                                <option value="">Todos los grupos</option>
                                <option value="1">Precios Retail</option>
                                <option value="2">Precios Mayorista</option>
                                <option value="3">Precios Especiales</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status-filter">Estado</label>
                            <select id="status-filter" class="form-control">
                                <option value="">Todos los estados</option>
                                <option value="active">Activas</option>
                                <option value="inactive">Inactivas</option>
                                <option value="expired">Expiradas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" onclick="filterPriceLists()">
                                üîç Filtrar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estad√≠sticas r√°pidas -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-number" id="active-lists-count">0</div>
                        <div class="stat-label">Listas Activas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="expired-lists-count">0</div>
                        <div class="stat-label">Listas Expiradas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-items-count">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="recent-changes-count">3</div>
                        <div class="stat-label">Cambios Recientes</div>
                    </div>
                </div>

                <!-- Tabla de listas de precios -->
                <div class="price-lists-table">
                    <table>
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nombre</th>
                                <th>Grupo</th>
                                <th>Moneda</th>
                                <th>Vigencia</th>
                                <th>Items</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="price-lists-tbody">
                            <!-- Las listas se cargan din√°micamente -->
                        </tbody>
                    </table>
                    <div id="empty-price-lists" class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <h3>No hay listas de precios</h3>
                        <p>Crea tu primera lista de precios para comenzar</p>
                        <button class="btn btn-success" onclick="createPriceList()">
                            ‚ûï Crear Lista
                        </button>
                    </div>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- PESTA√ëA: PRODUCTOS Y PRECIOS -->
            <!-- ============================================== -->
            <div id="products-tab" class="tab-panel">
                <!-- Header de la secci√≥n -->
                <div class="products-header">
                    <h2>
                        üè∑Ô∏è Gesti√≥n de Productos y Precios
                    </h2>
                    <div class="header-actions">
                        <button class="btn btn-warning" onclick="bulkUpdatePrices()">
                            üìä Actualizaci√≥n Masiva
                        </button>
                        <button class="btn btn-success" onclick="savePendingChanges()">
                            üíæ Guardar Cambios
                        </button>
                    </div>
                </div>

                <!-- Selector de lista de precios -->
                <div class="price-list-selector">
                    <label for="price-list-selector">Lista de Precios Activa</label>
                    <select id="price-list-selector" class="price-list-select" onchange="selectPriceListForProducts()">
                        <option value="">Seleccionar lista de precios...</option>
                    </select>
                    <div id="selected-list-info" class="selected-list-info">
                        <!-- Info de la lista seleccionada se carga din√°micamente -->
                    </div>
                </div>

                <!-- Filtros de productos -->
                <div class="products-filters">
                    <h4>üîç Filtros de Productos</h4>
                    <div class="products-search-grid">
                        <div class="form-group">
                            <label for="search-products">Buscar producto</label>
                            <input type="text" id="search-products" class="form-control" 
                                   placeholder="Buscar por nombre, SKU o marca..." autocomplete="off" />
                        </div>
                        <div class="form-group">
                            <label for="category-filter">Categor√≠a</label>
                            <select id="category-filter" class="form-control">
                                <option value="">Todas las categor√≠as</option>
                                <option value="2">Computaci√≥n</option>
                                <option value="3">Telefon√≠a</option>
                                <option value="4">Accesorios</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="brand-filter">Marca</label>
                            <input type="text" id="brand-filter" class="form-control" 
                                   placeholder="Filtrar por marca..." autocomplete="off" />
                        </div>
                        <div class="form-group">
                            <label for="price-status-filter">Estado de Precio</label>
                            <select id="price-status-filter" class="form-control">
                                <option value="">Todos</option>
                                <option value="with-price">Con precio</option>
                                <option value="without-price">Sin precio</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" onclick="filterProducts()">
                                üîç Filtrar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Barra de acciones masivas -->
                <div id="bulk-actions-bar" class="bulk-actions-bar">
                    <div class="bulk-actions-left">
                        <span class="selected-count" id="selected-count">0</span>
                        <span>productos seleccionados</span>
                    </div>
                    <div class="bulk-actions-right">
                        <button class="bulk-action-btn" onclick="bulkUpdatePrices()">
                            üìä Actualizar Precios
                        </button>
                        <button class="bulk-action-btn danger" onclick="bulkRemoveProducts()">
                            üóëÔ∏è Eliminar Selecci√≥n
                        </button>
                    </div>
                </div>

                <!-- Tabla de productos con precios -->
                <div class="products-price-table">
                    <table>
                        <thead>
                            <tr>
                                <th width="40">
                                    <input type="checkbox" id="select-all-products" 
                                           onchange="toggleAllProducts(this.checked)">
                                </th>
                                <th>Producto</th>
                                <th>Precio Costo</th>
                                <th>Precio Venta</th>
                                <th>Margen %</th>
                                <th>Historial</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody">
                            <!-- Los productos se cargan din√°micamente -->
                        </tbody>
                    </table>
                    <div id="empty-products" class="empty-state">
                        <div class="empty-state-icon">üè∑Ô∏è</div>
                        <h3>Selecciona una lista de precios</h3>
                        <p>Elige una lista de precios para ver y editar los productos</p>
                    </div>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- PESTA√ëA: COMPARADOR DE PRECIOS -->
            <!-- ============================================== -->
            <div id="comparison-tab" class="tab-panel">
                <!-- Header de la secci√≥n -->
                <div class="comparison-header">
                    <h2>üìä Comparador de Precios</h2>
                    <div class="comparison-subtitle">
                        Compara precios entre diferentes listas para an√°lisis de mercado
                    </div>
                </div>

                <!-- Filtros de comparaci√≥n -->
                <div class="comparison-filters">
                    <h4>üîç Filtros de Comparaci√≥n</h4>
                    <div class="comparison-grid">
                        <div class="form-group">
                            <label for="comparison-search">Buscar producto</label>
                            <input type="text" id="comparison-search" class="form-control" 
                                   placeholder="Buscar productos a comparar..." autocomplete="off" />
                        </div>
                        <div class="form-group">
                            <label for="comparison-category">Categor√≠a</label>
                            <select id="comparison-category" class="form-control">
                                <option value="">Todas las categor√≠as</option>
                                <option value="2">Computaci√≥n</option>
                                <option value="3">Telefon√≠a</option>
                                <option value="4">Accesorios</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="comparison-brand">Marca</label>
                            <input type="text" id="comparison-brand" class="form-control" 
                                   placeholder="Filtrar por marca..." autocomplete="off" />
                        </div>
                        <div class="form-group">
                            <button class="btn btn-primary" onclick="filterComparison()">
                                üîç Filtrar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Selecci√≥n de listas para comparar -->
                <div class="price-lists-selection">
                    <h4>üìã Seleccionar Listas para Comparar</h4>
                    <p class="text-muted">Marca las casillas de las listas que deseas incluir en la comparaci√≥n</p>
                    <div id="comparison-lists-checkboxes" class="lists-checkboxes">
                        <!-- Las listas se cargan din√°micamente -->
                    </div>
                </div>

                <!-- Tabla de comparaci√≥n -->
                <div id="comparison-table-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3>Selecciona listas para comparar</h3>
                        <p>Marca las casillas de las listas de precios que deseas comparar</p>
                    </div>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- PESTA√ëA: REPORTES Y AN√ÅLISIS -->
            <!-- ============================================== -->
            <div id="reports-tab" class="tab-panel">
                <!-- Header de la secci√≥n -->
                <div class="reports-header">
                    <h2>üìà Reportes y An√°lisis</h2>
                    <div class="comparison-subtitle">
                        An√°lisis estad√≠stico y reportes de listas de precios
                    </div>
                </div>

                <!-- Grid de reportes disponibles -->
                <div class="reports-grid">
                    <div class="report-card" onclick="generateReport('coverage')">
                        <div class="report-card-header">
                            <div class="report-icon">üìä</div>
                            <div>
                                <h3>Cobertura de Productos</h3>
                            </div>
                        </div>
                        <div class="report-description">
                            An√°lisis de cobertura de productos en las diferentes listas de precios
                        </div>
                        <div class="report-stats">
                            <div class="report-stat">
                                <span class="report-stat-value" id="total-products-report">0</span>
                                <span class="report-stat-label">Productos</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value" id="products-with-prices-report">0</span>
                                <span class="report-stat-label">Con Precios</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value" id="coverage-percentage-report">0%</span>
                                <span class="report-stat-label">Cobertura</span>
                            </div>
                        </div>
                    </div>

                    <div class="report-card" onclick="generateReport('margins')">
                        <div class="report-card-header">
                            <div class="report-icon">üí∞</div>
                            <div>
                                <h3>An√°lisis de M√°rgenes</h3>
                            </div>
                        </div>
                        <div class="report-description">
                            Distribuci√≥n y an√°lisis de m√°rgenes de ganancia por producto y categor√≠a
                        </div>
                        <div class="report-stats">
                            <div class="report-stat">
                                <span class="report-stat-value" id="average-margin-report">0%</span>
                                <span class="report-stat-label">Margen Promedio</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value">15</span>
                                <span class="report-stat-label">Productos</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value">3</span>
                                <span class="report-stat-label">Margen Bajo</span>
                            </div>
                        </div>
                    </div>

                    <div class="report-card" onclick="generateReport('price-changes')">
                        <div class="report-card-header">
                            <div class="report-icon">üìà</div>
                            <div>
                                <h3>Historial de Cambios</h3>
                            </div>
                        </div>
                        <div class="report-description">
                            Tracking de cambios de precios y an√°lisis de tendencias hist√≥ricas
                        </div>
                        <div class="report-stats">
                            <div class="report-stat">
                                <span class="report-stat-value" id="recent-changes-report">0</span>
                                <span class="report-stat-label">Cambios 7 d√≠as</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value">12</span>
                                <span class="report-stat-label">Cambios 30 d√≠as</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value">89%</span>
                                <span class="report-stat-label">Incrementos</span>
                            </div>
                        </div>
                    </div>

                    <div class="report-card" onclick="generateReport('competitive')">
                        <div class="report-card-header">
                            <div class="report-icon">‚öîÔ∏è</div>
                            <div>
                                <h3>An√°lisis Competitivo</h3>
                            </div>
                        </div>
                        <div class="report-description">
                            Comparativa de precios entre listas y an√°lisis de posicionamiento
                        </div>
                        <div class="report-stats">
                            <div class="report-stat">
                                <span class="report-stat-value">6</span>
                                <span class="report-stat-label">Listas</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value">45%</span>
                                <span class="report-stat-label">Variaci√≥n</span>
                            </div>
                            <div class="report-stat">
                                <span class="report-stat-value">Premium</span>
                                <span class="report-stat-label">M√°s Alta</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n de an√°lisis detallado -->
                <div class="analysis-section">
                    <div class="analysis-header">
                        <h3>üìä Distribuci√≥n de Precios por Categor√≠a</h3>
                        <div class="header-actions">
                            <button class="btn btn-info" onclick="exportReport('price-distribution')">
                                üì§ Exportar
                            </button>
                        </div>
                    </div>
                    <div class="chart-placeholder">
                        Gr√°fico de distribuci√≥n de precios por categor√≠a
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="analysis-header">
                        <h3>üíπ Evoluci√≥n de M√°rgenes</h3>
                        <div class="header-actions">
                            <button class="btn btn-info" onclick="exportReport('margin-evolution')">
                                üì§ Exportar
                            </button>
                        </div>
                    </div>
                    <div class="chart-placeholder">
                        Gr√°fico de evoluci√≥n de m√°rgenes en el tiempo
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales -->
    
    <!-- Modal de Edici√≥n de Lista de Precios -->
    <div id="priceListModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Editar Lista de Precios</h2>
                <span class="close" onclick="closePriceListModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="price-edit-form">
                    <div class="form-group">
                        <label for="modal-list-name">Nombre de la Lista</label>
                        <input type="text" id="modal-list-name" class="form-control" 
                               placeholder="Ej: Lista Premium 2025" />
                    </div>
                    <div class="form-group">
                        <label for="modal-list-code">C√≥digo</label>
                        <input type="text" id="modal-list-code" class="form-control" 
                               placeholder="Ej: PREMIUM_2025" />
                    </div>
                    <div class="form-group">
                        <label for="modal-list-group">Grupo</label>
                        <select id="modal-list-group" class="form-control">
                            <option value="">Seleccionar grupo...</option>
                            <option value="1">Precios Retail</option>
                            <option value="2">Precios Mayorista</option>
                            <option value="3">Precios Especiales</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modal-list-currency">Moneda</label>
                        <select id="modal-list-currency" class="form-control">
                            <option value="CLP">Peso Chileno (CLP)</option>
                            <option value="USD">D√≥lar Americano (USD)</option>
                            <option value="EUR">Euro (EUR)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modal-valid-from">V√°lido Desde</label>
                        <input type="date" id="modal-valid-from" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="modal-valid-to">V√°lido Hasta</label>
                        <input type="date" id="modal-valid-to" class="form-control" />
                        <small class="text-muted">Dejar vac√≠o para vigencia permanente</small>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closePriceListModal()">
                        Cancelar
                    </button>
                    <button class="btn btn-success" onclick="savePriceList()">
                        üíæ Guardar Lista
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Historial de Precios -->
    <div id="priceHistoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Historial de Precios</h2>
                <span class="close" onclick="closePriceHistoryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="price-history-content">
                    <!-- Contenido del historial se carga din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script>
        // Actualizar fecha actual
        document.addEventListener("DOMContentLoaded", function () {
            const now = new Date();
            const dateStr = now.toLocaleDateString("es-CL");
            document.getElementById("current-date").textContent = dateStr;

            // Funciones auxiliares para modales (placeholders)
            window.closePriceListModal = function() {
                document.getElementById('priceListModal').style.display = 'none';
            };

            window.closePriceHistoryModal = function() {
                document.getElementById('priceHistoryModal').style.display = 'none';
            };

            window.savePriceList = function() {
                showToast('Lista de precios guardada (demo)', 'success');
                closePriceListModal();
            };

            window.toggleAllProducts = function(checked) {
                document.querySelectorAll('.product-checkbox').forEach(cb => {
                    cb.checked = checked;
                    toggleProductSelection(parseInt(cb.value));
                });
            };

            window.bulkRemoveProducts = function() {
                if (selectedProducts.length === 0) {
                    showToast('Debe seleccionar productos primero', 'warning');
                    return;
                }
                
                if (confirm(`¬øEliminar ${selectedProducts.length} productos de la lista?`)) {
                    showToast(`${selectedProducts.length} productos eliminados`, 'warning');
                    selectedProducts = [];
                    updateBulkActionsBar();
                }
            };

            window.generateReport = function(reportType) {
                showToast(`Generando reporte: ${reportType}`, 'info');
            };

            window.exportReport = function(reportType) {
                showToast(`Exportando reporte: ${reportType}`, 'success');
            };

            window.filterComparison = function() {
                showToast('Filtros de comparaci√≥n aplicados', 'info');
            };

            // Cerrar modales con clic fuera
            window.onclick = function(event) {
                const modals = ['priceListModal', 'priceHistoryModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            };

            console.log(`
üîß ATAJOS DE TECLADO DISPONIBLES:
‚Ä¢ Ctrl + S: Guardar cambios pendientes
‚Ä¢ Ctrl + F: Enfocar b√∫squeda en pesta√±a activa
‚Ä¢ Alt + 1-4: Cambiar entre pesta√±as
‚Ä¢ Escape: Limpiar selecciones
‚Ä¢ Click en fila: Seleccionar lista/producto
            `);
        });
    </script>
</body>

</html>